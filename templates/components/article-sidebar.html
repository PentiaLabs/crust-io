{% set sep = "\\" %}
{% if path.split(sep).length == 1 %}
    {% set sep = "/" %}
{% endif %}

{% set parentpath = path.split(sep).slice(0, -1) %}
{% set parentnode = parentpath.pop() %}

{% set level1deep = path.split(sep).slice(2, -1) %}
{% if level1deep == "" %}
    {% set level1deep = path.split(sep).slice(1, -1) %}
{% endif %}
{% set category = level1deep.shift() %}

<!-- We need to set the top category to be able to differantiate when different departments has the same SOP titles -->
{% set topcategory = path.split(sep).slice(1, -1)[0] %}
{% if topcategory == category %}
    {% set topcategory = "" %}
{% endif %}
{% if category == parentnode %}
    {% set category = "" %}
{% endif %}
<aside class="article-sidebar">
    <a class="trigger" href="#" data-toggle="article-sidebar-nav">
        More from {{parentnode}}
    </a>
    
    <nav id="article-sidebar-nav" class="article-sidebar-nav" data-toggle-target="hide">
        <a class="manual-cover manual-cover--{{category | lower}}" href="{{sep}}{{path.split(sep).slice(0, -1).join(sep)}}">
            <h2 class="manual-title">{{parentnode}}</h2>
            <div class="manual-subtitle">SOP</div>
            <div class="manual-stack">{{topcategory}} {{category}}</div>
            <img class="manual-icon" src="/images/pentialogo.svg" alt="">
        </a>

        <ol class="manual-toc">
            {% for sibling in siblings %}
                <li {% if path == sibling.path %} class="current"{% endif %}>
                    <a class="article-title" href="{{sep}}{{sibling.path}}">{{sibling.name}}</a>
                </li>
            {% endfor %}
        </ol>
    </nav>
</aside>